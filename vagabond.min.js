!function(a){"use strict";var b=function(){var a=function(){var a,c,d,e=arguments,f=null;for(a=0;a<e.length;a+=1)for(d=e[a].split("."),f=b,c="VAGABOND"===d[0]?1:0;c<d.length;c++)f[d[c]]=f[d[c]]||{},f=f[d[c]];return f};return this.namespace=a,this}.call(b||{});a.VAGABOND=b}(this),function(){"use strict";VAGABOND.namespace("VAGABOND.MATRIX"),VAGABOND.MATRIX=function(a){var b={};return b.init=function(a,b,c){return this.grid={},this.height=a,this.width=b,this.setDefaults(c),this},b.setDefaults=function(a){this.defaults=UTIL.extend(a,{initValue:function(){return 0},formatValue:function(a){return a},formatReturn:function(a){return a},formatting:{OPEN:"[",SEPERATOR:", ",CLOSE:"]\n"}})},b.initGrid=function(a){var b,c;for(void 0===a&&(a=this.defaults.initValue),b=0;b<this.width;b++)for(this.grid[b]=[],c=0;c<this.height;c++)this.set(b,c,a(b,c,this.height,this.width));return this},b.get=function(a,b){return this.grid[a][b]},b.set=function(a,b,c){if(!this.isValidCoordinate(a,b))throw"OutOfBoundError: the coordinate ("+a+", "+b+") is out of bounds";this.grid[a][b]=c},b.wrappedGet=function(a,b){var c=this.wrapCoor(a,b);return this.get(c.x,c.y)},b.wrappedSet=function(a,b,c){var d=this.wrapCoor(a,b);return this.set(d.x,d.y,c)},b.clampedGet=function(a,b){var c=this.clampCoor(a,b);return this.get(c.x,c.y)},b.clampedSet=function(a,b,c){var d=this.clampCoor(a,b);return this.set(d.x,d.y,c)},b.clampCoor=function(a,b){return{x:UTIL.clamp(a,0,this.width-1),y:UTIL.clamp(b,0,this.height-1)}},b.wrapCoor=function(a,b){return{x:UTIL.wrap(a,0,this.width),y:UTIL.wrap(b,0,this.height)}},b.isValidCoordinate=function(a,b){return a>=0&&a<this.width&&b>=0&&b<this.height},b.clone=function(){var a=Object.create(b);return a.init(this.height,this.width,this.defaults),a.grid=JSON.parse(JSON.stringify(this.grid)),a},b.toString=function(a){var b,c,d,e="";for(a=UTIL.extend(a,{formatValue:this.defaults.formatValue,formatReturn:this.defaults.formatReturn,formatting:this.defaults.formatting}),b=0;b<this.width;b++){for(e+=a.formatting.OPEN,d="",c=0;c<this.height;c++)e+=d+a.formatValue.call(this,this.get(b,c),b,c),d=a.formatting.SEPERATOR;e+=a.formatting.CLOSE}return a.formatReturn.call(this,e)},a.Matrix=b,a}(VAGABOND.MATRIX)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.ALGORITHMS"),VAGABOND.ALGORITHMS=function(a){var b=function(a,b){function c(b,c){function e(a,b,c,d,e){var f=h(a,b,c);e.wrappedSet(a,b,g(f,d,e))}function f(a,b,c,d,e){var f=i(a,b,c);e.wrappedSet(a,b,g(f,d,e))}function g(a,b,c){var d,e,f=0,g=0;for(d=0;d<a.length;d++)e=a[d],c.isValidCoordinate(e.x,e.y)&&(f+=c.wrappedGet(e.x,e.y),g++);return f/=g,f+=Math.random()*b-b/2}function h(a,b,c){var d=Math.floor(c/2);return[{x:a+d,y:b+d},{x:a+d,y:b-d},{x:a-d,y:b+d},{x:a-d,y:b-d}]}function i(a,b,c){var d=Math.floor(c/2);return[{x:a+d,y:b},{x:a-d,y:b},{x:a,y:b+d},{x:a,y:b-d}]}var j,k,l=Math.floor(b/2);for(j=l;d+l>=j;j+=b)for(k=l;d+l>=k;k+=b)a.isValidCoordinate(k,j)&&e(k,j,b,c,a);for(j=0;d>=j;j+=b)for(k=0;d>=k;k+=b)a.isValidCoordinate(k+l,j)&&f(k+l,j,b,c,a),a.isValidCoordinate(k,j+l)&&f(k,j+l,b,c,a)}for(var d=a.width-1,e=d;e>1;)c(e,b),e/=2,b/=2},c=function(a,b){function c(){function b(a,b,c){var d,e,f,g,h,i,j=-(1/0),k={},l=[[1,1],[1,0],[1,-1],[0,-1],[-1,-1],[-1,0],[-1,1],[0,1],[0,0]];for(d=0;d<l.length;d++)e=l[d],f=b+e[0],g=c+e[1],a.isValidCoordinate(f,g)&&(h=Math.floor(a.get(f,g)),k[h]=k[h]?k[h]+1:1,j<k[h]&&(j=k[h],i=h));return i}var c=a.clone(),d=b.bind(null,c);a.initGrid(d)}var d;for(d=0;b>d;d++)c()};return a.diamondSquare=b,a.cellularAutomata=c,a}(VAGABOND.ALGORITHMS)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.MAPS"),VAGABOND.MAPS=function(a){var b=VAGABOND.MATRIX.Matrix,c=Object.create(b);return c.renderTo=function(a,b){var c,d,e;for(void 0===b&&(b=this.defaults.formatValue),e=a.getOrigin(),c=e.y;c<a.height+e.y;c++)for(d=e.x;d<a.width+e.x;d++)this.isValidCoordinate(d,c)&&a.set(d-e.x,c-e.y,b.call(this,this.get(d,c),d,c))},c.generate=function(){},a.Map=c,a}(VAGABOND.MAPS)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.ENTITIES"),VAGABOND.ENTITIES=function(a){var b={};return b.init=function(a,b,c,d){return this.id=a,this.x=b,this.y=c,this["char"]=d,this},b.takeTurn=function(){},b.getTraits=function(){return{x:this.x,y:this.y,id:this.id}},b.toString=function(a,b){return JSON.stringify(this.getTraits(),a,b)},b.renderTo=function(a,b){b=void 0!==b?b:function(a){return a["char"]};var c=a.getOrigin(),d=this.x-c.x,e=this.y-c.y;a.isValidCoordinate(d,e)&&a.set(d,e,b.call(this,this))},a.Entity=b,a}(VAGABOND.ENTITIES)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.ENTITIES"),VAGABOND.ENTITIES=function(a){var b=VAGABOND.ENTITIES.Entity,c=Object.create(b);return c.init=function(a,c,d,e,f){return b.init.call(this,a,c,d,e),this.hp=f,this},b.takeTurn=function(){this.hp<0&&(console.log("DEAD!"),this["char"]="X",this.move=function(){})},a.KillableEntity=c,a}(VAGABOND.ENTITIES)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.ENTITIES"),VAGABOND.ENTITIES=function(a){var b=VAGABOND.ENTITIES.KillableEntity,c=Object.create(b);return c.move=function(a,b){this.x+=a,this.y+=b},c.isValidMove=function(a,b,c){var d,e=c.map,f=this.x+a,g=this.y+b,h=!1;for(d=0;d<c.entityPool.length;d++){var i=c.entityPool[d];i.x===f&&i.y===g&&(h=!0)}return e.isValidCoordinate(f,g)&&0===e.get(f,g)&&!h},a.MovableKillableEntity=c,a}(VAGABOND.ENTITIES)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.ENTITIES"),VAGABOND.ENTITIES=function(a){var b=VAGABOND.ENTITIES.MovableKillableEntity,c=Object.create(b);return c.init=function(a,c,d,e,f,g){return b.init.call(this,a,d,e,f,g),this.name=c,this},a.Monster=c,a}(VAGABOND.ENTITIES)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.ENTITIES.ENEMIES"),VAGABOND.ENTITIES.ENEMIES=function(a){function b(a,b){var c=Math.abs(a.x-b.x),d=Math.abs(a.y-b.y);return c+d}var c=VAGABOND.ENTITIES.Monster,d=Object.create(c);return d.init=function(a,b,d){return c.init.call(this,UTIL.generateUUID(),"Goblin",a,b,"%",d)},d.attack=function(a){console.log(this.name,"attacks!"),a.hp-=10,a.hp<0&&(console.log(a.name,"is dead!"),a.move=function(){},a["char"]="X")},d.takeTurn=function(a){c.takeTurn.call(this);var d={x:a.player.x,y:a.player.y},e={x:this.x,y:this.y};1===b(e,d)?this.attack(a.player,a):this.takeNextMove(a)},d.takeNextMove=function(a){var c,d,e,f,g,h,i=1/0,j=[{dx:1,dy:0},{dx:0,dy:1},{dx:-1,dy:0},{dx:0,dy:-1}];j=UTIL.shuffle(j);var k={x:a.player.x,y:a.player.y};for(c=0;c<j.length;c++)d=j[c],this.isValidMove(d.dx,d.dy,a)&&(e={x:this.x+d.dx,y:this.y+d.dy},g=b(e,k),i>g&&(i=g,h=d,f=e));if(h){var l={x:this.x,y:this.y},m=b(f,k),n=b(l,k);this.isValidMove(h.dx,h.dy,a)&&n>m&&this.move(h.dx,h.dy)}},a.Goblin=d,a}(VAGABOND.ENTITIES.ENEMIES)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.MAPS.FACTORY"),VAGABOND.MAPS.FACTORY=function(a){var b=VAGABOND.MAPS.Map,c=VAGABOND.ALGORITHMS,d=function(a,d){d=UTIL.extend(d,{formatValue:function(a){return Math.floor(UTIL.clamp(a,0,31)).toString(32)},initValue:function(){return UTIL.random(6,26)}});var e=Object.create(b).init(a,a,d);return e.generate=function(){this.initGrid(),c.diamondSquare(this,30)},e.type="height",e},e=function(a,d,e){e=UTIL.extend(e,{formatValue:function(a){return 1===a?"O":0===a?"0":" "},initValue:function(){return Math.random()>.55?1:0}});var f=Object.create(b).init(a,d,e);return f.generate=function(){this.initGrid(),c.cellularAutomata(this,5)},f.type="dungeon",f};return a.createHeightMap=d,a.createDungeonMap=e,a}(VAGABOND.MAPS.FACTORY)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.CONTROLS"),VAGABOND.CONTROLS=function(a){var b=UTIL.VIRTUAL_KEYS.VirtualKeys,c={};return c.init=function(){return this.eventStack=[],this.codes={},this.codes[b.VK_LEFT]="screenLeft",this.codes[b.VK_RIGHT]="screenRight",this.codes[b.VK_UP]="screenUp",this.codes[b.VK_DOWN]="screenDown",this.codes[b.VK_A]="charLeft",this.codes[b.VK_D]="charRight",this.codes[b.VK_W]="charUp",this.codes[b.VK_S]="charDown",this.codes[b.VK_SPACE]="generate",this.codes[b.VK_1]="diamondSquare",this.codes[b.VK_2]="cellularAutomata",this.codes[b.VK_RETURN]="initMap",this.codes[b.VK_CONTROL]="switchMapType",document.addEventListener("keydown",this.onKey.bind(this),!1),this},c.onKey=function(a){var b=this.codes[a.keyCode];void 0!==b&&(0===this.eventStack.length&&this.eventStack.push({state:b,render:!0}),void 0!==a.preventDefault&&a.preventDefault(),void 0!==a.stopPropagation&&a.stopPropagation())},a.Listener=c,a}(VAGABOND.CONTROLS)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.CONTROLS"),VAGABOND.CONTROLS=function(a){function b(a,b){var e=b.map;"generate"===a?e.generate():"diamondSquare"===a?c.diamondSquare(e,30):"cellularAutomata"===a?c.cellularAutomata(e,1):"initMap"===a?e.initGrid():"switchMapType"===a&&("height"===e.type?b.map=d.createDungeonMap(129,129):b.map=d.createHeightMap(129),b.map.initGrid())}var c=VAGABOND.ALGORITHMS,d=VAGABOND.MAPS.FACTORY,e={};return e.init=function(a){return this.listener=a,this},e.processInput=function(a,c,d){if(this.listener.eventStack.length>0){var e=this.listener.eventStack.pop(),f=e.state,g={screenUp:{dx:0,dy:-1,entity:a,useTurn:!1},screenDown:{dx:0,dy:1,entity:a,useTurn:!1},screenLeft:{dx:-1,dy:0,entity:a,useTurn:!1},screenRight:{dx:1,dy:0,entity:a,useTurn:!1},charUp:{dx:0,dy:-1,entity:c,useTurn:!0},charDown:{dx:0,dy:1,entity:c,useTurn:!0},charLeft:{dx:-1,dy:0,entity:c,useTurn:!0},charRight:{dx:1,dy:0,entity:c,useTurn:!0}},h=g[f];h&&h.entity.isValidMove(h.dx,h.dy,d)&&h.entity.move(h.dx,h.dy),h&&h.useTurn&&d.takeTurn(),b(f,d),e.render&&(d.renderTo(a),a.renderToElement(document.body.getElementsByClassName("map")[0]))}},a.Controller=e,a}(VAGABOND.CONTROLS)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.SCREEN"),VAGABOND.SCREEN=function(a){var b=VAGABOND.MATRIX.Matrix,c=Object.create(b);return c.init=function(a,c,d,e){return this.originX=d,this.originY=e,b.init.call(this,a,c,{initValue:function(){return" "}}).initGrid(),this},c.clear=b.initGrid,c.move=function(a,b){this.originX+=a,this.originY+=b},c.isValidMove=function(a,b,c){var d=c.map,e=this.originX+a,f=this.originY+b;return d.isValidCoordinate(e+this.width-1,f+this.height-1)&&d.isValidCoordinate(e+this.width-1,f)&&d.isValidCoordinate(e,f+this.height-1)&&d.isValidCoordinate(e,f)},c.getOrigin=function(){return{x:this.originX,y:this.originY}},c.toElement=function(a){var b,c,d,e,f;for(a=UTIL.extend(a,{formatValue:function(a){return a},formatElement:function(a){var b=document.createElement("span");return b.className="tile-"+a,b.innerHTML=a,b}}),d=document.createElement("div"),d.className="screen",b=0;b<this.height;b++){for(c=0;c<this.width;c++)f=a.formatValue.call(this,this.get(c,b),c,b),e=a.formatElement.call(this,f,c,b),d.appendChild(e);d.appendChild(document.createElement("br"))}return d},c.renderToElement=function(a){var b=this.toElement();a.innerHTML=b.innerHTML},a.Screen=c,a}(VAGABOND.SCREEN)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.LEVEL"),VAGABOND.LEVEL=function(a){var b={};return b.init=function(a,b){return this.entityPool=void 0===b?[]:b,this.map=a,this},b.addEntity=function(){var a=arguments;a[0]instanceof Array&&(a=a[0]),Array.prototype.push.apply(this.entityPool,a)},b.setPlayer=function(a){this.player=a},b.takeTurn=function(){var a,b;for(a=0;a<this.entityPool.length;a++)b=this.entityPool[a],b.takeTurn(this)},b.renderTo=function(a){var b;for(a.clear(),this.map.renderTo(a),b=0;b<this.entityPool.length;b++)this.entityPool[b].renderTo(a)},a.Level=b,a}(VAGABOND.LEVEL)}(),function(a){"use strict";var b=VAGABOND.ENTITIES.Monster,c=VAGABOND.ENTITIES.ENEMIES.Goblin,d=VAGABOND.MAPS.FACTORY,e=VAGABOND.SCREEN.Screen,f=VAGABOND.LEVEL.Level,g=VAGABOND.CONTROLS.Listener,h=VAGABOND.CONTROLS.Controller,i=Object.create(b).init(0,"Milo",4,4,"#",34),j=Object.create(c).init(5,10,50),k=Object.create(c).init(8,15,60),l=d.createDungeonMap(129,129),m=Object.create(e).init(20,80,0,0),n=Object.create(g).init(),o=Object.create(h).init(n),p=Object.create(f).init(l);n.eventStack.unshift({state:"generate",render:!0}),p.addEntity(i,j,k);var q;for(q=0;30>q;q++)p.addEntity(Object.create(c).init(Math.floor(129*Math.random()),Math.floor(129*Math.random()),50));p.setPlayer(i);var r=function(){o.processInput(m,i,p),UTIL.setTimeout(r,50)};r()}(this);
//# sourceMappingURL=vagabond.min.js.map