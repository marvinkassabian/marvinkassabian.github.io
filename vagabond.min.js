!function(a){"use strict";var b=function(){var a=function(){var a,c,d,e=arguments,f=null;for(a=0;a<e.length;a+=1)for(d=e[a].split("."),f=b,c="VAGABOND"===d[0]?1:0;c<d.length;c++)f[d[c]]=f[d[c]]||{},f=f[d[c]];return f};return this.namespace=a,this}.call(b||{});a.VAGABOND=b}(this),function(){"use strict";VAGABOND.namespace("VAGABOND.MATRIX"),VAGABOND.MATRIX=function(a){var b={};return b.init=function(a,b,c){return this.grid={},this.height=a,this.width=b,this.setDefaults(c),this},b.setDefaults=function(a){this.defaults=UTIL.extend(a,{initValue:function(){return 0},formatValue:function(a){return a},formatReturn:function(a){return a},formatting:{OPEN:"[",SEPERATOR:", ",CLOSE:"]\n"}})},b.initGrid=function(a){var b,c;for(void 0===a&&(a=this.defaults.initValue),b=0;b<this.height;b++)for(c=0;c<this.width;c++)this.set(c,b,a(c,b,this.height,this.width));return this},b.get=function(a,b){return this.grid[b*this.width+a]},b.set=function(a,b,c){if(!this.isValidCoordinate(a,b))throw"OutOfBoundError: the coordinate ("+a+", "+b+") is out of bounds";this.grid[b*this.width+a]=c},b.wrappedGet=function(a,b){var c=this.wrapCoor(a,b);return this.get(c.x,c.y)},b.wrappedSet=function(a,b,c){var d=this.wrapCoor(a,b);return this.set(d.x,d.y,c)},b.clampedGet=function(a,b){var c=this.clampCoor(a,b);return this.get(c.x,c.y)},b.clampedSet=function(a,b,c){var d=this.clampCoor(a,b);return this.set(d.x,d.y,c)},b.clampCoor=function(a,b){return{x:UTIL.clamp(a,0,this.width-1),y:UTIL.clamp(b,0,this.height-1)}},b.wrapCoor=function(a,b){return{x:UTIL.wrap(a,0,this.width),y:UTIL.wrap(b,0,this.height)}},b.isValidCoordinate=function(a,b){return a>=0&&a<this.width&&b>=0&&b<this.height},b.clone=function(){var a=Object.create(b);return a.init(this.height,this.width,this.defaults),a.grid=JSON.parse(JSON.stringify(this.grid)),a},b.toString=function(a){var b,c,d,e="";for(a=UTIL.extend(a,{formatValue:this.defaults.formatValue,formatReturn:this.defaults.formatReturn,formatting:this.defaults.formatting}),b=0;b<this.height;b++){for(e+=a.formatting.OPEN,d="",c=0;c<this.width;c++)e+=d+a.formatValue.call(this,this.get(c,b),c,b),d=a.formatting.SEPERATOR;e+=a.formatting.CLOSE}return a.formatReturn.call(this,e)},b.renderTo=function(a,b){var c,d,e;for(void 0===b&&(b=this.defaults.formatValue),e=a.getOrigin(),c=e.y;c<a.height+e.y;c++)for(d=e.x;d<a.width+e.x;d++)this.isValidCoordinate(d,c)&&a.set(d-e.x,c-e.y,b.call(this,this.get(d,c),d,c))},a.Matrix=b,a}(VAGABOND.MATRIX)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.ALGORITHMS"),VAGABOND.ALGORITHMS=function(a){var b=function(a,b){function c(b,c){function e(a,b,c,d,e){var f=h(a,b,c);e.wrappedSet(a,b,g(f,d,e))}function f(a,b,c,d,e){var f=i(a,b,c);e.wrappedSet(a,b,g(f,d,e))}function g(a,b,c){var d,e,f=0,g=0;for(d=0;d<a.length;d++)e=a[d],c.isValidCoordinate(e.x,e.y)&&(f+=c.wrappedGet(e.x,e.y),g++);return f/=g,f+=Math.random()*b-b/2}function h(a,b,c){var d=Math.floor(c/2);return[{x:a+d,y:b+d},{x:a+d,y:b-d},{x:a-d,y:b+d},{x:a-d,y:b-d}]}function i(a,b,c){var d=Math.floor(c/2);return[{x:a+d,y:b},{x:a-d,y:b},{x:a,y:b+d},{x:a,y:b-d}]}var j,k,l=Math.floor(b/2);for(j=l;d+l>=j;j+=b)for(k=l;d+l>=k;k+=b)a.isValidCoordinate(k,j)&&e(k,j,b,c,a);for(j=0;d>=j;j+=b)for(k=0;d>=k;k+=b)a.isValidCoordinate(k+l,j)&&f(k+l,j,b,c,a),a.isValidCoordinate(k,j+l)&&f(k,j+l,b,c,a)}for(var d=a.width-1,e=d;e>1;)c(e,b),e/=2,b/=2},c=function(a,b){function c(){function b(a,b,c){var d,e,f,g,h,i,j=-(1/0),k={},l=[[1,1],[1,0],[1,-1],[0,-1],[-1,-1],[-1,0],[-1,1],[0,1],[0,0]];for(d=0;d<l.length;d++)e=l[d],f=b+e[0],g=c+e[1],a.isValidCoordinate(f,g)&&(h=a.get(f,g),k[h]=k[h]?k[h]+1:1,j<k[h]&&(j=k[h],i=h));return i}var c=a.clone(),d=b.bind(null,c);a.initGrid(d)}var d;for(d=0;b>d;d++)c()};return a.diamondSquare=b,a.cellularAutomata=c,a}(VAGABOND.ALGORITHMS)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.MAPS.MAP_MODES"),VAGABOND.MAPS.MAP_MODES=function(a){var b=VAGABOND.ALGORITHMS,c={diamondSquare:{generate:b.diamondSquare,formatValue:function(a){return Math.floor(UTIL.clamp(a,0,31)).toString(32)},initValue:function(){return UTIL.random(6,26)},algorithmArgs:[30]},cellularAutomata:{generate:b.cellularAutomata,formatValue:function(a){return a?"0":"O"},initValue:function(){return Math.random()>.5?1:0},algorithmArgs:[1]}},d=["diamondSquare","cellularAutomata"];return a.MapModes=c,a.MapModeNames=d,a}(VAGABOND.MAPS.MAP_MODES)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.MAPS"),VAGABOND.MAPS=function(a){var b=VAGABOND.MATRIX.Matrix,c=VAGABOND.MAPS.MAP_MODES,d=Object.create(b);return d.init=function(a,c,d,e){return b.init.call(this,a,c,e),this.setType(d),this},d.setType=function(a){var b,d;this.mapType=a,b=c.MapModes[a],d=UTIL.extend({initValue:b.initValue,formatValue:b.formatValue},this.defaults),this.setDefaults(d)},a.Map=d,a}(VAGABOND.MAPS)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.ENTITIES"),VAGABOND.ENTITIES=function(a){var b={};return b.init=function(a,b,c,d){return this.id=a,this.x=b,this.y=c,this["char"]=d,this},b.getTraits=function(){return{coor:{x:this.x,y:this.y},"char":this["char"]}},b.takeTurn=function(){},b.toString=function(a,b){return JSON.stringify(this.getTraits(),a,b)},b.renderTo=function(a,b){b=void 0!==b?b:function(a){return a["char"]};var c=a.getOrigin(),d=this.x-c.x,e=this.y-c.y;a.isValidCoordinate(d,e)&&a.set(d,e,b.call(this,this))},a.Entity=b,a}(VAGABOND.ENTITIES)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.ENTITIES"),VAGABOND.ENTITIES=function(a){var b=VAGABOND.ENTITIES.Entity,c=Object.create(b);return c.init=function(a,c,d,e,f){return b.init.call(this,a,c,d,e),this.hp=f,this},c.getTraits=function(){var a=b.getTraits.call(this);return a.health=this.hp,a},a.KillableEntity=c,a}(VAGABOND.ENTITIES)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.ENTITIES"),VAGABOND.ENTITIES=function(a){var b=VAGABOND.ENTITIES.KillableEntity,c=Object.create(b);return c.move=function(a,b){this.x+=a,this.y+=b},c.isValidMove=function(a,b,c){var d=this.x+a,e=this.y+b;return c.isValidCoordinate(d,e)},a.MovableKillableEntity=c,a}(VAGABOND.ENTITIES)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.ENTITIES"),VAGABOND.ENTITIES=function(a){var b=VAGABOND.ENTITIES.MovableKillableEntity,c=Object.create(b);return c.init=function(a,c,d,e,f,g){return b.init.call(this,a,d,e,f,g),this.name=c,this},c.getTraits=function(){var a=b.getTraits.call(this);return a.name=this.name,a},a.Monster=c,a}(VAGABOND.ENTITIES)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.ENTITIES.ENEMIES"),VAGABOND.ENTITIES.ENEMIES=function(a){var b=VAGABOND.ENTITIES.Monster,c=Object.create(b);return c.init=function(a,c,d){return b.init.call(this,UTIL.generateUUID(),"Goblin",a,c,"%",d)},c.attack=function(){console.log(this.name,"attacks!")},c.takeTurn=function(a){var b=[{dx:1,dy:0},{dx:0,dy:1},{dx:-1,dy:0},{dx:0,dy:-1}],c=b[Math.floor(4*Math.random())];this.isValidMove(c.dx,c.dy,a.map)&&this.move(c.dx,c.dy)},a.Goblin=c,a}(VAGABOND.ENTITIES.ENEMIES)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.MAPS"),VAGABOND.MAPS=function(a){var b={};return b.init=function(){},b.renderTo=function(){},a.HeightMap=b,a}(VAGABOND.MAPS)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.CONTROLS"),VAGABOND.CONTROLS=function(a){var b=UTIL.VIRTUAL_KEYS.VirtualKeys,c={};return c.init=function(){return this.eventStack=[],this.codes={},this.codes[b.VK_LEFT]="screenLeft",this.codes[b.VK_RIGHT]="screenRight",this.codes[b.VK_UP]="screenUp",this.codes[b.VK_DOWN]="screenDown",this.codes[b.VK_A]="charLeft",this.codes[b.VK_D]="charRight",this.codes[b.VK_W]="charUp",this.codes[b.VK_S]="charDown",this.codes[b.VK_SPACE]="algorithm",this.codes[b.VK_RETURN]="initMap",this.codes[b.VK_CONTROL]="switchMapType",document.addEventListener("keydown",this.onKey.bind(this),!1),this},c.onKey=function(a){var b=this.codes[a.keyCode];void 0!==b&&(0===this.eventStack.length&&this.eventStack.push({state:b,render:!0}),void 0!==a.preventDefault&&a.preventDefault(),void 0!==a.stopPropagation&&a.stopPropagation())},a.Listener=c,a}(VAGABOND.CONTROLS)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.CONTROLS"),VAGABOND.CONTROLS=function(a){var b=VAGABOND.MAPS.MAP_MODES,c={};return c.init=function(a){return this.listener=a,this},c.processInput=function(a,c,d,e){if(this.listener.eventStack.length>0){var f=this.listener.eventStack.pop(),g=f.state,h={screenUp:{dx:0,dy:-1,entity:a,useTurn:!1},screenDown:{dx:0,dy:1,entity:a,useTurn:!1},screenLeft:{dx:-1,dy:0,entity:a,useTurn:!1},screenRight:{dx:1,dy:0,entity:a,useTurn:!1},charUp:{dx:0,dy:-1,entity:c,useTurn:!0},charDown:{dx:0,dy:1,entity:c,useTurn:!0},charLeft:{dx:-1,dy:0,entity:c,useTurn:!0},charRight:{dx:1,dy:0,entity:c,useTurn:!0}},i=h[g];i&&i.entity.isValidMove(i.dx,i.dy,d)&&i.entity.move(i.dx,i.dy),i&&i.useTurn&&e.takeTurn();var j=b.MapModes[d.mapType];if("algorithm"===g)j.generate.bind(null,d).apply(null,j.algorithmArgs);else if("initMap"===g)d.initGrid();else if("switchMapType"===g){var k=b.MapModeNames.indexOf(d.mapType),l=UTIL.wrap(k+1,0,b.MapModeNames.length);d.setType(b.MapModeNames[l]),this.listener.eventStack.unshift({state:"initMap",render:!0})}f.render&&(e.renderTo(a),a.renderToElement(document.body))}},a.Controller=c,a}(VAGABOND.CONTROLS)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.SCREEN"),VAGABOND.SCREEN=function(a){var b=VAGABOND.MATRIX.Matrix,c=Object.create(b);return c.init=function(a,c,d,e){return this.originX=d,this.originY=e,b.init.call(this,a,c,function(){return" "}).initGrid(),this},c.clear=b.initGrid,c.move=function(a,b){this.originX+=a,this.originY+=b},c.isValidMove=function(a,b,c){var d=this.originX+a,e=this.originY+b;return c.isValidCoordinate(d+this.width-1,e+this.height-1)&&c.isValidCoordinate(d+this.width-1,e)&&c.isValidCoordinate(d,e+this.height-1)&&c.isValidCoordinate(d,e)},c.getOrigin=function(){return{x:this.originX,y:this.originY}},c.toHTML=function(a){var b,c,d,e,f;for(a=UTIL.extend(a,{formatValue:function(a){return a},formatElement:function(a){var b=document.createElement("span");return b.className="tile-"+a,b.innerHTML=a,b}}),d=document.createElement("div"),d.className="screen",b=0;b<this.height;b++){for(c=0;c<this.width;c++)f=a.formatValue.call(this,this.get(c,b),c,b),e=a.formatElement.call(this,f,c,b),d.appendChild(e);d.appendChild(document.createElement("br"))}return d},c.renderToElement=function(a){var b=this.toHTML();a.replaceChild(b,a.firstChild)},a.Screen=c,a}(VAGABOND.SCREEN)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.LEVEL"),VAGABOND.LEVEL=function(a){var b={};return b.init=function(a,b){return this.entityPool=void 0===b?[]:b,this.map=a,this},b.addEntity=function(){var a=arguments;a[0]instanceof Array&&(a=a[0]),Array.prototype.push.apply(this.entityPool,a)},b.takeTurn=function(){var a,b;for(a=0;a<this.entityPool.length;a++)b=this.entityPool[a],b.takeTurn(this)},b.renderTo=function(a){var b;for(a.clear(),this.map.renderTo(a),b=0;b<this.entityPool.length;b++)this.entityPool[b].renderTo(a)},a.Level=b,a}(VAGABOND.LEVEL)}(),function(a){"use strict";var b=VAGABOND.ENTITIES.Monster,c=VAGABOND.ENTITIES.ENEMIES.Goblin,d=VAGABOND.MAPS.Map,e=VAGABOND.SCREEN.Screen,f=VAGABOND.LEVEL.Level,g=VAGABOND.CONTROLS.Listener,h=VAGABOND.CONTROLS.Controller,i=Object.create(b).init(0,"Milo",4,4,"#",30),j=Object.create(c).init(5,10,50),k=Object.create(c).init(8,15,60),l=Object.create(d).init(129,129,"diamondSquare"),m=Object.create(e).init(20,80,0,0),n=Object.create(g).init(),o=Object.create(h).init(n),p=Object.create(f).init(l);n.eventStack.push({state:"algorithm",render:!0},{state:"initMap",render:!1}),p.addEntity(i,j,k);var q=function(){o.processInput(m,i,l,p),UTIL.setTimeout(q,10)};q()}(this);
//# sourceMappingURL=vagabond.min.map