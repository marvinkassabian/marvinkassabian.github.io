!function(a){"use strict";var b=function(){var a=function(){var a,c,d,e=arguments,f=null;for(a=0;a<e.length;a+=1)for(d=e[a].split("."),f=b,c="VAGABOND"===d[0]?1:0;c<d.length;c++)f[d[c]]=f[d[c]]||{},f=f[d[c]];return f};return this.namespace=a,this}.call(b||{});a.VAGABOND=b}(this),function(){"use strict";VAGABOND.namespace("VAGABOND.DATA_STRUCTURES"),VAGABOND.DATA_STRUCTURES=function(a){var b={};return b.init=function(a,b,c){return this.grid=[],this.height=a,this.width=b,this.setDefaults(c),this},b.setDefaults=function(a){this.defaults=UTIL.extend(a,{initValue:function(){return 0},formatValue:function(a){return a},formatReturn:function(a){return a},formatting:{OPEN:"[",SEPERATOR:", ",CLOSE:"]\n"}})},b.initGrid=function(a){var b,c;for(void 0===a&&(a=this.defaults.initValue),b=0;b<this.width;b++)for(this.grid[b]=this.grid[b]||[],c=0;c<this.height;c++)this.set(b,c,a(b,c,this.height,this.width));return this},b.get=function(a,b){return this.grid[a][b]},b.set=function(a,b,c){if(!this.isValidCoordinate(a,b))throw"OutOfBoundError: the coordinate ("+a+", "+b+") is out of bounds";this.grid[a][b]=c},b.wrappedGet=function(a,b){var c=this.wrapCoor(a,b);return this.get(c.x,c.y)},b.wrappedSet=function(a,b,c){var d=this.wrapCoor(a,b);return this.set(d.x,d.y,c)},b.clampedGet=function(a,b){var c=this.clampCoor(a,b);return this.get(c.x,c.y)},b.clampedSet=function(a,b,c){var d=this.clampCoor(a,b);return this.set(d.x,d.y,c)},b.clampCoor=function(a,b){return{x:UTIL.clamp(a,0,this.width-1),y:UTIL.clamp(b,0,this.height-1)}},b.wrapCoor=function(a,b){return{x:UTIL.wrap(a,0,this.width),y:UTIL.wrap(b,0,this.height)}},b.isValidCoordinate=function(a,b){return a>=0&&a<this.width&&b>=0&&b<this.height&&a%1===0&&b%1===0},b.clone=function(){var a=Object.create(b);return a.init(this.height,this.width,this.defaults),a.grid=JSON.parse(JSON.stringify(this.grid)),a},b.toString=function(a){var b,c,d,e="";for(a=UTIL.extend(a,{formatValue:this.defaults.formatValue,formatReturn:this.defaults.formatReturn,formatting:this.defaults.formatting}),b=0;b<this.width;b++){for(e+=a.formatting.OPEN,d="",c=0;c<this.height;c++)e+=d+a.formatValue.call(this,this.get(b,c),b,c),d=a.formatting.SEPERATOR;e+=a.formatting.CLOSE}return a.formatReturn.call(this,e)},a.Matrix=b,a}(VAGABOND.DATA_STRUCTURES)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.DATA_STRUCTURES"),VAGABOND.DATA_STRUCTURES=function(a){var b=VAGABOND.DATA_STRUCTURES.Matrix,c={};c.init=function(a,b,c,d){return this.id=a,this.x=b,this.y=c,this.weight=d,this.neighbors=[],this.entities=[],this};var d={};d.init=function(a){this.height=a.height,this.width=a.width,this.vertexMatrix=Object.create(b).init(this.height,this.width),this.vertexMatrix.initGrid(),this.vertices=[],this.vertexCount=0;var d,e,f,g,h;for(d=0;d<this.width;d++)for(e=0;e<this.height;e++)f=a.get(d,e),h=this.vertexCount,g=Object.create(c).init(h,d,e,f),this.vertexMatrix.set(d,e,g),this.vertices[h]=g,this.vertexCount++;var i,j,k;for(d=0;d<this.width;d++)for(e=0;e<this.height;e++)for(g=this.vertexMatrix.get(d,e),i=0;i<UTIL.VALID_MOVES.length;i++)j=UTIL.VALID_MOVES[i],this.vertexMatrix.isValidCoordinate(d+j[0],e+j[1])&&(k=this.vertexMatrix.get(d+j[0],e+j[1]),g.neighbors.push(k));return this},d.adjacent=function(a,b){return-1!==a.neighbors.indexOf(b)};var e=32767;return d.getEdgeValue=function(a,b){if(a=this.getVertex(a),b=this.getVertex(b),a.weight===e)return b.weight/Math.min(a.weight,b.weight)*UTIL.distance(a,b,2);var c=Math.max(a.weight,b.weight)*UTIL.distance(a,b,2);return 0>=c&&console.log(c),c},d.getVertex=function(a){return this.vertexMatrix.get(a.x,a.y)},d.setVertex=function(a,b){return this.vertexMatrix.set(a.x,a.y,b)},a.Graph=d,a.Vertex=c,a}(VAGABOND.DATA_STRUCTURES)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.VIEW"),VAGABOND.VIEW=function(a){var b={};return b.renderToElement=function(a){var b=this.toElement();a.innerHTML=b.innerHTML},a.View=b,a}(VAGABOND.VIEW)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.VIEW"),VAGABOND.VIEW=function(a){var b=VAGABOND.VIEW.View,c=Object.create(b);return c.init=function(a,b){return this.logger=a,this.offset=0,this.visibleLogSize=b||10,this},c.getSize=function(){return this.logger.getSize()},c.toElement=function(){var a=document.createElement("div");a.className="logs";for(var b=this.offset;b<Math.min(this.logger.logs.length,this.offset+this.visibleLogSize);b++){var c=this.logger.logs[b],d=document.createElement("span");d.innerHTML=c.innerHTML,a.appendChild(d),a.appendChild(document.createElement("br"))}return a},a.Logs=c,a}(VAGABOND.VIEW)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.VIEW"),VAGABOND.VIEW=function(a){var b=VAGABOND.VIEW.View,c=Object.create(b);return c.init=function(a){return this.selectedEntity=a,this},c.setEntity=c.init,c.toElement=function(){var a=document.createElement("div");a.className="selected-info";var b=this.selectedEntity.getInformation();for(var c in b){var d=document.createElement("span");d.innerHTML=c+": "+b[c],a.appendChild(d),a.appendChild(document.createElement("br"))}return a},a.Information=c,a}(VAGABOND.VIEW)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.SCREEN"),VAGABOND.SCREEN=function(a){var b=VAGABOND.DATA_STRUCTURES.Matrix,c=VAGABOND.VIEW.View,d=Object.create(b);return d.init=function(a,c,d,e){return this.originX=d,this.originY=e,b.init.call(this,a,c,{initValue:function(){return" "}}).initGrid(),this},d.clear=b.initGrid,d.move=function(a,b){this.originX+=a,this.originY+=b},d.isValidMove=function(a,b,c){var d=c.map,e=this.originX+a,f=this.originY+b;return d.isValidCoordinate(e+this.width-1,f+this.height-1)&&d.isValidCoordinate(e+this.width-1,f)&&d.isValidCoordinate(e,f+this.height-1)&&d.isValidCoordinate(e,f)},d.getOrigin=function(){return{x:this.originX,y:this.originY}},d.toElement=function(a){var b,c,d,e,f;for(a=UTIL.extend(a,{formatValue:function(a){return a},formatElement:function(a,b,c){var d=this.getOrigin(),e=document.createElement("span");return e.classList.add("tile","tile-"+(" "===a?"SPACE":a),"clickable"),e.id=b+d.x+":"+(c+d.y),e.dataset.x=b+d.x,e.dataset.y=c+d.y,e.innerHTML=a,e}}),d=document.createElement("div"),d.className="screen",b=0;b<this.height;b++){for(c=0;c<this.width;c++)f=a.formatValue.call(this,this.get(c,b),c,b),e=a.formatElement.call(this,f,c,b),d.appendChild(e);d.appendChild(document.createElement("br"))}return d},d.renderToElement=c.renderToElement,a.Screen=d,a}(VAGABOND.SCREEN)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.ALGORITHMS"),VAGABOND.ALGORITHMS=function(a){var b=function(a,b,c,d){function e(a){return a.pathWeight=1/0,a.heuristic=d(a,c),a.getTotal=function(){return this.pathWeight+this.heuristic},a.previousVertex=void 0,a}function f(a){for(var b=[];void 0!==a.previousVertex;){var c=a.previousVertex;b.unshift({dx:a.x-c.x,dy:a.y-c.y}),a=c}return b}d=d||function(a,b){return UTIL.manhattanDistance(a,b)};var g,h,i,j=[],k=[],l=!1;for(var m in a.vertices)g=e(a.vertices[m]),g.x===b.x&&g.y===b.y&&(g.pathWeight=0),k.push(g);for(;!l&&0!==k.length;)for(k.sort(function(a,b){return-1*(a.getTotal()-b.getTotal())}),g=k.pop(),j.push(g),h=0;h<g.neighbors.length;h++)i=g.neighbors[h],-1===j.indexOf(i)&&(i.pathWeight=g.pathWeight+a.getEdgeValue(g,i),i.previousVertex=g,j.push(i),k.push(i),i.x===c.x&&i.y===c.y&&(l=!0));return f(a.getVertex(c))};return a.aStar=b,a}(VAGABOND.ALGORITHMS)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.ALGORITHMS"),VAGABOND.ALGORITHMS=function(a){var b=function(a,b,c){function d(){function b(a,b,d){for(var e,f=-(1/0),g={},h=0;h<UTIL.ADJACENT.length;h++){var i=UTIL.ADJACENT[h],j=b+i[0],k=d+i[1];if(a.isValidCoordinate(j,k)){var l=Math.floor(a.get(j,k));g[l]=g[l]?g[l]+1:1,f<g[l]&&(f=g[l],e=l)}}return c(e,g)}var d=a.clone(),e=b.bind(null,d);a.initGrid(e)}c=c||function(a){return a};for(var e=0;b>e;e++)d()};return a.cellularAutomata=b,a}(VAGABOND.ALGORITHMS)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.ALGORITHMS"),VAGABOND.ALGORITHMS=function(a){var b=function(a,b){function c(b,c){function e(a,b,c,d,e){var f=h(a,b,c);e.wrappedSet(a,b,g(f,d,e))}function f(a,b,c,d,e){var f=i(a,b,c);e.wrappedSet(a,b,g(f,d,e))}function g(a,b,c){var d,e,f=0,g=0;for(d=0;d<a.length;d++)e=a[d],c.isValidCoordinate(e.x,e.y)&&(f+=c.wrappedGet(e.x,e.y),g++);return f/=g,f+=Math.random()*b-b/2}function h(a,b,c){var d=Math.floor(c/2);return[{x:a+d,y:b+d},{x:a+d,y:b-d},{x:a-d,y:b+d},{x:a-d,y:b-d}]}function i(a,b,c){var d=Math.floor(c/2);return[{x:a+d,y:b},{x:a-d,y:b},{x:a,y:b+d},{x:a,y:b-d}]}var j,k,l=Math.floor(b/2);for(j=l;d+l>=j;j+=b)for(k=l;d+l>=k;k+=b)a.isValidCoordinate(k,j)&&e(k,j,b,c,a);for(j=0;d>=j;j+=b)for(k=0;d>=k;k+=b)a.isValidCoordinate(k+l,j)&&f(k+l,j,b,c,a),a.isValidCoordinate(k,j+l)&&f(k,j+l,b,c,a)}for(var d=a.width-1,e=d;e>1;)c(e,b),e/=2,b/=2};return a.diamondSquare=b,a}(VAGABOND.ALGORITHMS)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.MODEL.MAPS"),VAGABOND.MODEL.MAPS=function(a){var b=VAGABOND.DATA_STRUCTURES.Matrix,c=VAGABOND.DATA_STRUCTURES.Graph,d=Object.create(b);return d.init=function(a,d,e){return b.init.call(this,a,d,e),this.graph=Object.create(c),this},d.initGrid=function(a){b.initGrid.call(this,a),this.graph.init(this)},d.renderTo=function(a,b){var c,d,e;for(void 0===b&&(b=this.defaults.formatValue),e=a.getOrigin(),c=e.y;c<a.height+e.y;c++)for(d=e.x;d<a.width+e.x;d++)this.isValidCoordinate(d,c)&&a.set(d-e.x,c-e.y,b.call(this,this.get(d,c),d,c))},d.generate=function(){},d.getPossibleMoves=function(a){function b(a,e,f){var g,h,i,j,k=UTIL.VALID_MOVES;if(!(d[e.x+":"+e.y]>=a)&&a>0)for(void 0===d[e.x+":"+e.y]&&c.push(e),d[e.x+":"+e.y]=a,h=0;h<k.length;h++)g=k[h],i={x:e.x+g[0],y:e.y+g[1]},f.isValidCoordinate(i.x,i.y)&&(j=a-f.graph.getEdgeValue(e,i),b(j,i,f))}var c=[],d={};return b(a.movement,a,this),c},a.Map=d,a}(VAGABOND.MODEL.MAPS)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.MODEL.MAPS.FACTORY"),VAGABOND.MODEL.MAPS.FACTORY=function(a){var b=VAGABOND.MODEL.MAPS.Map,c=VAGABOND.ALGORITHMS,d=function(a,d){d=UTIL.extend(d,{formatValue:function(a){return Math.floor(UTIL.clamp(a,0,31)).toString(32)},initValue:function(){return UTIL.random(1,7)}});var e=Object.create(b).init(a,a,d);return e.generate=function(){this.initGrid(),c.diamondSquare(this,60),this.initGrid(function(a,b){return Math.max(Math.floor(this.get(a,b)),1)}.bind(this))},e.type="height",e},e=32767,f=1,g=function(a,d,g){g=UTIL.extend(g,{formatValue:function(a){return a===e?"O":a===f?".":" "},initValue:function(){return Math.random()<.4?e:f}});var h=Object.create(b).init(a,d,g);return h.generate=function(){this.initGrid(),c.cellularAutomata(this,3,function(a,b){return void 0===b[e]?e:a});for(var a=0;a<this.width;a++)for(var b=0;b<this.height;b++)(a>=0&&4>a||a>=this.width-4&&a<this.width)&&(b>=this.height/2-4&&b<=this.height/2+4?this.set(a,b,f):this.set(a,b,e)),(b>=0&&4>b||b>=this.height-4&&b<this.height)&&(a>=this.width/2-4&&a<=this.width/2+4?this.set(a,b,f):this.set(a,b,e));c.cellularAutomata(this,7)},h.type="dungeon",h};return a.createHeightMap=d,a.createDungeonMap=g,a.WALL_WEIGHT=e,a}(VAGABOND.MODEL.MAPS.FACTORY)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.MODEL.ENTITIES"),VAGABOND.MODEL.ENTITIES=function(a){var b={};return b.init=function(a,b,c,d){return this.id=a,this.x=b,this.y=c,this.z=0,this["char"]=d,this.actionCounts={main:0,secondary:0,minor:0},this},b.takeTurn=function(){},b.getInformation=function(){return{x:this.x,y:this.y,"char":this["char"]}},b.toString=function(a,b){return JSON.stringify(this.getTraits(),a,b)},b.renderTo=function(a,b){b=void 0!==b?b:function(a){return a["char"]};var c=a.getOrigin(),d=this.x-c.x,e=this.y-c.y;a.isValidCoordinate(d,e)&&a.set(d,e,b.call(this,this))},a.Entity=b,a}(VAGABOND.MODEL.ENTITIES)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.MODEL.ENTITIES"),VAGABOND.MODEL.ENTITIES=function(a){var b=VAGABOND.MODEL.ENTITIES.Entity,c=Object.create(b);return c.init=function(a,c,d,e,f){return b.init.call(this,a,c,d,e),this.totalHp=f,this.hp=f,this},c.getInformation=function(){var a=b.getInformation.call(this);return a.hp=this.hp,a.totalHp=this.totalHp,a},c.die=function(){this["char"]="X",this.z=-1},c.isDead=function(){return this.hp<=0},a.KillableEntity=c,a}(VAGABOND.MODEL.ENTITIES)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.MODEL.ENTITIES"),VAGABOND.MODEL.ENTITIES=function(a){var b=VAGABOND.MODEL.ENTITIES.KillableEntity,c=Object.create(b);return c.init=function(a,c,d,e,f){return b.init.call(this,a,c,d,e,f),this.movement=16,this},c.move=function(a,b){this.x+=a,this.y+=b,this.hp=Math.min(this.hp+1,this.totalHp)},c.isValidMove=function(a,b,c){var d,e=c.map,f=this.x+a,g=this.y+b,h=!1;for(d=0;d<c.entityPool.length;d++){var i=c.entityPool[d];i.x===f&&i.y===g&&i.hp>0&&(h=!0)}return e.isValidCoordinate(f,g)&&e.graph.getEdgeValue(this,{x:f,y:g})<this.movement&&!h},a.MovableKillableEntity=c,a}(VAGABOND.MODEL.ENTITIES)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.MODEL.ENTITIES"),VAGABOND.MODEL.ENTITIES=function(a){var b=VAGABOND.MODEL.ENTITIES.MovableKillableEntity,c=UTIL.LOGGER.getLogger(),d=Object.create(b);return d.init=function(a,c,d,e,f,g,h){return b.init.call(this,UTIL.generateUUID(),a,c,d,e),this.name=f,this.type=g,this.strength=h,this},d.getFullName=function(){return this.name+", the "+this.type},d.getInformation=function(){var a=b.getInformation.call(this);return a.name=this.name,a.type=this.type,a.fullName=this.getFullName(),a.strength=this.strength,a},d.attack=function(a){c.log(c.toSentenceElement(this,"attacked",a)),a.hp=Math.max(a.hp-this.strength,0),a.isDead()&&(c.log(c.toSentenceElement(this,"killed",a)),a.die())},a.Monster=d,a}(VAGABOND.MODEL.ENTITIES)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.MODEL.ENTITIES.ENEMIES"),VAGABOND.MODEL.ENTITIES.ENEMIES=function(a){function b(){var a=UTIL.VALID_MOVES,b=a[Math.floor(UTIL.random(a.length))];return{dx:b[0],dy:b[1]}}var c=VAGABOND.MODEL.ENTITIES.Monster,d=VAGABOND.ALGORITHMS,e=Object.create(c);return e.init=function(a,b,d,e){return this.aStarWeights=[UTIL.random(10,1),UTIL.random(5,1)],c.init.call(this,a,b,"%",d,e,"Goblin",3)},e.takeTurn=function(a){if(c.takeTurn.call(this),!this.isDead()){var d={x:a.player.x,y:a.player.y},e={x:this.x,y:this.y},f=UTIL.manhattanDistance(e,d);if(1===f&&a.player.hp>0)this.attack(a.player,a);else if(10>f&&a.player.hp>0)this.takeNextMove(a);else{var g=b();this.isValidMove(g.dx,g.dy,a)&&this.move(g.dx,g.dy)}}},e.takeNextMove=function(a){var b={x:a.player.x,y:a.player.y},c={x:this.x,y:this.y},e=d.aStar(a.map.graph,c,b,function(a,b){return this.aStarWeights[0]*UTIL.distance(a,b,this.aStarWeights[1])}.bind(this)),f=e.shift();this.isValidMove(f.dx,f.dy,a)&&this.move(f.dx,f.dy)},a.Goblin=e,a}(VAGABOND.MODEL.ENTITIES.ENEMIES)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.MODEL.ENTITIES"),VAGABOND.MODEL.ENTITIES=function(a){var b=VAGABOND.MODEL.ENTITIES.Monster,c=Object.create(b);return c.die=function(){b.die.call(this),this.move=function(){},this.attack=function(){},this.takeTurn=function(){}},a.PlayerEntity=c,a}(VAGABOND.MODEL.ENTITIES)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.MODEL"),VAGABOND.MODEL=function(a){var b={};return b.init=function(a){return this.entityPool=[],this.entityMap={},this.map=a,this},b.getEntitiesAt=function(a){for(var b=[],c=0;c<this.entityPool.length;c++){var d=this.entityPool[c];d.x===a.x&&d.y===a.y&&b.push(d)}return b},b.addEntity=function(){var a=arguments;a[0]instanceof Array&&(a=a[0]);for(var b=0;b<a.length;b++){var c=a[b];this.entityMap[c.id]=c}Array.prototype.push.apply(this.entityPool,a)},b.setPlayer=function(a){this.player=a},b.takeTurn=function(){var a,b;for(a=0;a<this.entityPool.length;a++)b=this.entityPool[a],b.takeTurn(this)},b.renderTo=function(a){var b;a.clear(),this.map.renderTo(a);var c=this.entityPool.sort(function(a,b){return a.z-b.z});for(b=0;b<c.length;b++)c[b].renderTo(a)},a.Level=b,a}(VAGABOND.MODEL)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.CONTROLLER.EVENT_STACK"),VAGABOND.CONTROLLER.EVENT_STACK=function(a){var b,c=function(){return void 0===b&&(b=Object.create(e).init()),b},d=function(a){b=a},e={};return e.init=function(){return this.eventStack=[],this},e.addEvent=function(a){0===this.eventStack.length&&this.eventStack.push(a)},e.addEventSequence=function(a){if(0===this.eventStack.length)for(var b=0;b<a.length;b++)this.eventStack.push(a[b])},e.getEvent=function(){return this.eventStack.shift()||{state:"nothing",render:!1}},e.getSize=function(){return this.eventStack.length},a.getEventStack=c,a.setEventStack=d,a.EventStack=e,a}(VAGABOND.CONTROLLER.EVENT_STACK)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.CONTROLLER"),VAGABOND.CONTROLLER=function(a){var b=UTIL.VIRTUAL_KEYS.VirtualKeys,c=VAGABOND.CONTROLLER.EVENT_STACK.getEventStack(),d={};return d.init=function(){return this.codes={},this.codes[b.VK_LEFT]="screenLeft",this.codes[b.VK_RIGHT]="screenRight",this.codes[b.VK_UP]="screenUp",this.codes[b.VK_DOWN]="screenDown",this.codes[b.VK_A]="charLeft",this.codes[b.VK_D]="charRight",this.codes[b.VK_W]="charUp",this.codes[b.VK_S]="charDown",this.codes[b.VK_NUMPAD8]="logUp",this.codes[b.VK_NUMPAD2]="logDown",this.codes[b.VK_F]="endTurn",this.codes[b.VK_SPACE]="generate",this.codes[b.VK_RETURN]="initMap",this.codes[b.VK_CONTROL]="switchMapType",document.addEventListener("keydown",this.onKey.bind(this),!1),this},d.onKey=function(a){var b=this.codes[a.keyCode];void 0!==b&&(c.addEvent({state:b,render:!0}),void 0!==a.preventDefault&&a.preventDefault(),void 0!==a.stopPropagation&&a.stopPropagation())},a.KeyListener=d,a}(VAGABOND.CONTROLLER)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.CONTROLLER"),VAGABOND.CONTROLLER=function(a){var b={},c=VAGABOND.CONTROLLER.EVENT_STACK.getEventStack();return b.init=function(){return this.tileMap={},this.setupTileListeners(),this.setupLogListeners(),this},b.setupLogListeners=function(){function a(a){var b=a.dataset.id;c.addEvent({state:"clickLog",render:!0,useTurn:!1,data:{id:b}})}for(var b=document.getElementsByClassName("log"),d=0;d<b.length;d++){var e=b[d];e.addEventListener("click",a.bind(null,e),!1)}},b.setupTileListeners=function(){function a(a){var b={x:parseInt(a.dataset.x),y:parseInt(a.dataset.y)};c.addEvent({state:"clickTile",render:!0,useTurn:!1,data:{coordinate:b}})}for(var b=document.getElementsByClassName("tile"),d=0;d<b.length;d++){var e=b[d];e.addEventListener("click",a.bind(null,e),!1),this.tileMap[e.dataset.x+":"+e.dataset.y]=e}},b.getTile=function(a,b){return this.tileMap[a+":"+b]},a.ClickListener=b,a}(VAGABOND.CONTROLLER)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.CONTROLLER"),VAGABOND.CONTROLLER=function(a){function b(a,b){var c=b.state;"logDown"===c?a.offset=Math.min(a.offset+1,Math.max(a.getSize()-1,0)):"logUp"===c&&(a.offset=Math.max(a.offset-1,0))}function c(a,b,c,d){var e;if("clickTile"===d.state){var f={x:d.data.coordinate.x,y:d.data.coordinate.y};e=a.getEntitiesAt(f).sort(function(a,b){return b.hp-a.hp})[0],void 0!==e?(b.init(e),1===UTIL.manhattanDistance(c,e)&&e.hp>0&&(c.attack(e),d.useTurn=!0)):b.init(c)}else"clickLog"===d.state&&(e=a.entityMap[d.data.id],b.init(e))}function d(a,b){for(var c=a.map.getPossibleMoves(a.player),d=0;d<c.length;d++){var e=c[d],f=b.getTile(e.x,e.y);f&&f.classList.add("possible")}}function e(a,b){var c=b.map;if("generate"===a)c.generate();else if("initMap"===a)c.initGrid();else if("switchMapType"===a){var d=Math.max(c.width,c.height);"height"===c.type?b.map=f.createDungeonMap(d,d):b.map=f.createHeightMap(d),b.map.initGrid()}}var f=VAGABOND.MODEL.MAPS.FACTORY,g=VAGABOND.CONTROLLER.ClickListener,h=VAGABOND.CONTROLLER.EVENT_STACK.getEventStack(),i={};return i.init=function(a){return this.listener=a,this},i.processInput=function(a,f,i,j,k){if(h.getSize()>0){var l=h.getEvent(),m=l.state,n={screenUp:{dx:0,dy:-1,entity:a,useTurn:!1},screenDown:{dx:0,dy:1,entity:a,useTurn:!1},screenLeft:{dx:-1,dy:0,entity:a,useTurn:!1},screenRight:{dx:1,dy:0,entity:a,useTurn:!1},charUp:{dx:0,dy:-1,entity:f,useTurn:!0},charDown:{dx:0,dy:1,entity:f,useTurn:!0},charLeft:{dx:-1,dy:0,entity:f,useTurn:!0},charRight:{dx:1,dy:0,entity:f,useTurn:!0}},o=n[m];if(o&&o.entity.isValidMove(o.dx,o.dy,i)&&o.entity.move(o.dx,o.dy),c(i,j,f,l),b(k,l),(o&&o.useTurn||l.useTurn)&&i.takeTurn(),e(m,i),l.render){i.renderTo(a),a.renderToElement(document.body.getElementsByClassName("screen")[0]),j.renderToElement(document.body.getElementsByClassName("selected-info")[0]),k.renderToElement(document.body.getElementsByClassName("logs")[0]);var p=Object.create(g).init();d(i,p)}}},a.Controller=i,a}(VAGABOND.CONTROLLER)}(),function(){"use strict";VAGABOND.namespace("VAGABOND.CONTROLLER"),VAGABOND.CONTROLLER=function(a){var b=1e3,c={};return c.init=function(a){return this.timeStep=a||1/30,this.frameCallback=this.frame.bind(this),this.processCallback=function(){},this},c.start=function(a){this.processCallback=a,this.frameCallback()},c.frame=function(){this.processCallback(),UTIL.setTimeout(this.frameCallback,this.timeStep*b)},a.GameLoop=c,a}(VAGABOND.CONTROLLER)}();
//# sourceMappingURL=vagabond.min.js.map