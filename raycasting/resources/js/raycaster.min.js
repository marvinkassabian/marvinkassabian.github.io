"use strict";var Engine;!function(a){var b;!function(a){function b(a,b,c){var d=Math.max(a,b);return Math.min(d,c)}a.CIRCLE=2*Math.PI,a.clamp=b}(b=a.Util||(a.Util={}))}(Engine||(Engine={}));var Engine;!function(a){var b;!function(a){!function(a){a[a.VK_CANCEL=3]="VK_CANCEL",a[a.VK_HELP=6]="VK_HELP",a[a.VK_BACK_SPACE=8]="VK_BACK_SPACE",a[a.VK_TAB=9]="VK_TAB",a[a.VK_CLEAR=12]="VK_CLEAR",a[a.VK_RETURN=13]="VK_RETURN",a[a.VK_ENTER=14]="VK_ENTER",a[a.VK_SHIFT=16]="VK_SHIFT",a[a.VK_CONTROL=17]="VK_CONTROL",a[a.VK_ALT=18]="VK_ALT",a[a.VK_PAUSE=19]="VK_PAUSE",a[a.VK_CAPS_LOCK=20]="VK_CAPS_LOCK",a[a.VK_ESCAPE=27]="VK_ESCAPE",a[a.VK_SPACE=32]="VK_SPACE",a[a.VK_PAGE_UP=33]="VK_PAGE_UP",a[a.VK_PAGE_DOWN=34]="VK_PAGE_DOWN",a[a.VK_END=35]="VK_END",a[a.VK_HOME=36]="VK_HOME",a[a.VK_LEFT=37]="VK_LEFT",a[a.VK_UP=38]="VK_UP",a[a.VK_RIGHT=39]="VK_RIGHT",a[a.VK_DOWN=40]="VK_DOWN",a[a.VK_PRINTSCREEN=44]="VK_PRINTSCREEN",a[a.VK_INSERT=45]="VK_INSERT",a[a.VK_DELETE=46]="VK_DELETE",a[a.VK_0=48]="VK_0",a[a.VK_1=49]="VK_1",a[a.VK_2=50]="VK_2",a[a.VK_3=51]="VK_3",a[a.VK_4=52]="VK_4",a[a.VK_5=53]="VK_5",a[a.VK_6=54]="VK_6",a[a.VK_7=55]="VK_7",a[a.VK_8=56]="VK_8",a[a.VK_9=57]="VK_9",a[a.VK_COLON=58]="VK_COLON",a[a.VK_SEMICOLON=59]="VK_SEMICOLON",a[a.VK_LESS_THAN=60]="VK_LESS_THAN",a[a.VK_EQUALS=61]="VK_EQUALS",a[a.VK_GREATER_THAN=62]="VK_GREATER_THAN",a[a.VK_QUESTION_MARK=63]="VK_QUESTION_MARK",a[a.VK_AT=64]="VK_AT",a[a.VK_A=65]="VK_A",a[a.VK_B=66]="VK_B",a[a.VK_C=67]="VK_C",a[a.VK_D=68]="VK_D",a[a.VK_E=69]="VK_E",a[a.VK_F=70]="VK_F",a[a.VK_G=71]="VK_G",a[a.VK_H=72]="VK_H",a[a.VK_I=73]="VK_I",a[a.VK_J=74]="VK_J",a[a.VK_K=75]="VK_K",a[a.VK_L=76]="VK_L",a[a.VK_M=77]="VK_M",a[a.VK_N=78]="VK_N",a[a.VK_O=79]="VK_O",a[a.VK_P=80]="VK_P",a[a.VK_Q=81]="VK_Q",a[a.VK_R=82]="VK_R",a[a.VK_S=83]="VK_S",a[a.VK_T=84]="VK_T",a[a.VK_U=85]="VK_U",a[a.VK_V=86]="VK_V",a[a.VK_W=87]="VK_W",a[a.VK_X=88]="VK_X",a[a.VK_Y=89]="VK_Y",a[a.VK_Z=90]="VK_Z",a[a.VK_CONTEXT_MENU=93]="VK_CONTEXT_MENU",a[a.VK_NUMPAD0=96]="VK_NUMPAD0",a[a.VK_NUMPAD1=97]="VK_NUMPAD1",a[a.VK_NUMPAD2=98]="VK_NUMPAD2",a[a.VK_NUMPAD3=99]="VK_NUMPAD3",a[a.VK_NUMPAD4=100]="VK_NUMPAD4",a[a.VK_NUMPAD5=101]="VK_NUMPAD5",a[a.VK_NUMPAD6=102]="VK_NUMPAD6",a[a.VK_NUMPAD7=103]="VK_NUMPAD7",a[a.VK_NUMPAD8=104]="VK_NUMPAD8",a[a.VK_NUMPAD9=105]="VK_NUMPAD9",a[a.VK_MULTIPLY=106]="VK_MULTIPLY",a[a.VK_ADD=107]="VK_ADD",a[a.VK_SEPARATOR=108]="VK_SEPARATOR",a[a.VK_SUBTRACT=109]="VK_SUBTRACT",a[a.VK_DECIMAL=110]="VK_DECIMAL",a[a.VK_DIVIDE=111]="VK_DIVIDE",a[a.VK_F1=112]="VK_F1",a[a.VK_F2=113]="VK_F2",a[a.VK_F3=114]="VK_F3",a[a.VK_F4=115]="VK_F4",a[a.VK_F5=116]="VK_F5",a[a.VK_F6=117]="VK_F6",a[a.VK_F7=118]="VK_F7",a[a.VK_F8=119]="VK_F8",a[a.VK_F9=120]="VK_F9",a[a.VK_F10=121]="VK_F10",a[a.VK_F11=122]="VK_F11",a[a.VK_F12=123]="VK_F12",a[a.VK_F13=124]="VK_F13",a[a.VK_F14=125]="VK_F14",a[a.VK_F15=126]="VK_F15",a[a.VK_F16=127]="VK_F16",a[a.VK_F17=128]="VK_F17",a[a.VK_F18=129]="VK_F18",a[a.VK_F19=130]="VK_F19",a[a.VK_F20=131]="VK_F20",a[a.VK_F21=132]="VK_F21",a[a.VK_F22=133]="VK_F22",a[a.VK_F23=134]="VK_F23",a[a.VK_F24=135]="VK_F24",a[a.VK_NUM_LOCK=144]="VK_NUM_LOCK",a[a.VK_SCROLL_LOCK=145]="VK_SCROLL_LOCK",a[a.VK_CIRCUMFLEX=160]="VK_CIRCUMFLEX",a[a.VK_EXCLAMATION=161]="VK_EXCLAMATION",a[a.VK_DOUBLE_QUOTE=162]="VK_DOUBLE_QUOTE",a[a.VK_HASH=163]="VK_HASH",a[a.VK_DOLLAR=164]="VK_DOLLAR",a[a.VK_PERCENT=165]="VK_PERCENT",a[a.VK_AMPERSAND=166]="VK_AMPERSAND",a[a.VK_UNDERSCORE=167]="VK_UNDERSCORE",a[a.VK_OPEN_PAREN=168]="VK_OPEN_PAREN",a[a.VK_CLOSE_PAREN=169]="VK_CLOSE_PAREN",a[a.VK_ASTERISK=170]="VK_ASTERISK",a[a.VK_PLUS=171]="VK_PLUS",a[a.VK_PIPE=172]="VK_PIPE",a[a.VK_HYPHEN_MINUS=173]="VK_HYPHEN_MINUS",a[a.VK_OPEN_CURLY_BRACKET=174]="VK_OPEN_CURLY_BRACKET",a[a.VK_CLOSE_CURLY_BRACKET=175]="VK_CLOSE_CURLY_BRACKET",a[a.VK_TILDE=176]="VK_TILDE",a[a.VK_COMMA=188]="VK_COMMA",a[a.VK_PERIOD=190]="VK_PERIOD",a[a.VK_SLASH=191]="VK_SLASH",a[a.VK_BACK_QUOTE=192]="VK_BACK_QUOTE",a[a.VK_OPEN_BRACKET=219]="VK_OPEN_BRACKET",a[a.VK_BACK_SLASH=220]="VK_BACK_SLASH",a[a.VK_CLOSE_BRACKET=221]="VK_CLOSE_BRACKET",a[a.VK_QUOTE=222]="VK_QUOTE",a[a.VK_META=224]="VK_META",a[a.VK_ALTGR=225]="VK_ALTGR",a[a.VK_WIN=91]="VK_WIN",a[a.VK_KANA=21]="VK_KANA",a[a.VK_HANGUL=21]="VK_HANGUL",a[a.VK_EISU=22]="VK_EISU",a[a.VK_JUNJA=23]="VK_JUNJA",a[a.VK_FINAL=24]="VK_FINAL",a[a.VK_HANJA=25]="VK_HANJA",a[a.VK_KANJI=25]="VK_KANJI",a[a.VK_CONVERT=28]="VK_CONVERT",a[a.VK_NONCONVERT=29]="VK_NONCONVERT",a[a.VK_ACCEPT=30]="VK_ACCEPT",a[a.VK_MODECHANGE=31]="VK_MODECHANGE",a[a.VK_SELECT=41]="VK_SELECT",a[a.VK_PRINT=42]="VK_PRINT",a[a.VK_EXECUTE=43]="VK_EXECUTE",a[a.VK_SLEEP=95]="VK_SLEEP"}(a.VirtualKey||(a.VirtualKey={}));a.VirtualKey}(b=a.VirtualKey||(a.VirtualKey={}))}(Engine||(Engine={}));var Engine;!function(a){var b;!function(b){var c,d=a.Util,e=2.4,f=1.2,g=1e3,h=500,i=50,j=2,k=0,l=-25,m=1/0,n=0,o=1e3,p=-1e3;!function(a){a[a.FORWARD=1]="FORWARD",a[a.RIGHT=2]="RIGHT",a[a.BACKWARD=4]="BACKWARD",a[a.LEFT=8]="LEFT"}(c||(c={}));var q={};q[8]="left",q[2]="right",q[1]="forward",q[4]="backward";var r={0:1/0,1:0*d.CIRCLE,2:.25*d.CIRCLE,3:1/8*d.CIRCLE,4:.5*d.CIRCLE,5:1/0,6:3/8*d.CIRCLE,7:.25*d.CIRCLE,8:.75*d.CIRCLE,9:7/8*d.CIRCLE,10:1/0,11:0*d.CIRCLE,12:5/8*d.CIRCLE,13:.75*d.CIRCLE,14:.5*d.CIRCLE,15:1/0},s=function(){function a(a,b,c){this.x=a,this.y=b,this.direction=c,this.crouchModifier=0,this.jumpModifier=0,this.viewAngle=0,this.verticalVelocity=0,this.moveWhileJumping=!1}return a.prototype.rotate=function(a){this.direction=(this.direction+a+d.CIRCLE)%d.CIRCLE},a.prototype.walk=function(a,b,c){this.move(a,b,this.direction+c)},a.prototype.move=function(a,b,c){var d=Math.cos(c)*a,e=Math.sin(c)*a;b.get(this.x+d,this.y)<=0&&(this.x+=d),b.get(this.x,this.y+e)<=0&&(this.y+=e)},a.prototype.changeCrouchModifier=function(a){this.crouchModifier=d.clamp(this.crouchModifier+a,l,k)},a.prototype.changeJumpModifier=function(a){this.jumpModifier=d.clamp(this.jumpModifier+a,n,m)},a.prototype.changeViewAngle=function(a){this.viewAngle=d.clamp(this.viewAngle+a,p,o)},a.prototype.update=function(a,b,d){var k=0,l=!1;for(var m in c)a[q[m]]&&this.onGround()&&(this.walk(e*d,b,r[m]),l=!0,k+=+m);a.turnLeft&&this.rotate(-1*f*Math.PI*d),a.turnRight&&this.rotate(f*Math.PI*d),a.lookUp&&this.changeViewAngle(g*d),a.lookDown&&this.changeViewAngle(-1*g*d),this.changeCrouchModifier(a.crouch?-1*h*d:h*d),a.jump&&this.onGround()&&(this.verticalVelocity=5,console.log(k),console.log(typeof k),k=r[k],this.jumpDirection=k+this.direction,this.moveWhileJumping=k!==1/0?l:!1),this.onGround()||this.moveWhileJumping&&this.move(j*d,b,this.jumpDirection),this.verticalVelocity-=15*d,this.changeJumpModifier(i*d*this.verticalVelocity)},a.prototype.getHeightInformation=function(){return{heightModifier:this.crouchModifier+this.jumpModifier,viewAngle:this.viewAngle}},a.prototype.onGround=function(){return this.jumpModifier===n},a}();b.Player=s}(b=a.Player||(a.Player={}))}(Engine||(Engine={}));var Engine;!function(a){var b;!function(b){var c=(a.VirtualKey.VirtualKey,function(){function a(){var a=this;this.inputs={},this.inputs.mouseLeft="turnLeft",this.inputs.mouseRight="turnRight",this.inputs.mouseUp="lookUp",this.inputs.mouseDown="lookDown",this.inputs[65]="left",this.inputs[68]="right",this.inputs[87]="forward",this.inputs[83]="backward",this.inputs[37]="turnLeft",this.inputs[39]="turnRight",this.inputs[38]="lookUp",this.inputs[40]="lookDown",this.inputs[88]="crouch",this.inputs[32]="jump",this.states={},_.each(_.values(this.inputs),function(b){a.states[b]=!1}),document.addEventListener("keydown",this.onKey.bind(this,!0),!1),document.addEventListener("keyup",this.onKey.bind(this,!1),!1),document.addEventListener("mousemove",this.onMouseMove.bind(this),!1),document.body.onclick=document.body.requestPointerLock||document.body.mozRequestPointerLock||document.body.webkitRequestPointerLock}return a.prototype.onKey=function(a,b){var c=this.inputs[b.keyCode];"undefined"!=typeof c&&(this.states[c]=a,b.preventDefault&&b.preventDefault(),b.stopPropagation&&b.stopPropagation())},a.prototype.onMouseMove=function(a){var b=this,c=this.inputs.mouseLeft,d=this.inputs.mouseRight,e=this.inputs.mouseUp,f=this.inputs.mouseDown,g=a.movementX||a.mozMovementX||a.webkitMovementX||0,h=a.movementY||a.mozMovementY||a.webkitMovementY||0;g>0?this.states[d]=!0:0>g&&(this.states[c]=!0),h>0?this.states[f]=!0:0>h&&(this.states[e]=!0),setTimeout(function(){b.onMouseMoveEnd(a)},10)},a.prototype.onMouseMoveEnd=function(a){var b=this.inputs.mouseLeft,c=this.inputs.mouseRight,d=this.inputs.mouseUp,e=this.inputs.mouseDown;this.states[b]=!1,this.states[c]=!1,this.states[d]=!1,this.states[e]=!1,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation()},a}());b.Controls=c}(b=a.Controls||(a.Controls={}))}(Engine||(Engine={}));var Engine;!function(a){var b;!function(a){var b=function(){function a(a,b,c){this.image=new Image,this.image.src=a,this.width=b,this.height=c}return a}();a.Bitmap=b}(b=a.Bitmap||(a.Bitmap={}))}(Engine||(Engine={}));var Engine;!function(a){var b;!function(b){var c=a.Bitmap.Bitmap,d=.3,e={length:1/0},f=function(){function a(a){this.size=a,this.wallGrid=new Uint8Array(a*a),this.skybox=new c("resources/images/sky_texture.png",128,64),this.wallTexture=new c("resources/images/wall_texture.png",640,640)}return a.prototype.get=function(a,b){return a=Math.floor(a),b=Math.floor(b),0>a||a>=this.size||0>b||b>=this.size?-1:this.wallGrid[b*this.size+a]},a.prototype.randomize=function(a){void 0===a&&(a=d);for(var b=a,c=0;c<this.size*this.size;c++)this.wallGrid[c]=Math.random()<b?1:0},a.prototype.cast=function(a,b,c){function d(a){var b=f(i,j,a.x,a.y,!1),e=f(j,i,a.y,a.x,!0),h=b.length<e.length?g(b,1,0,a.distance,b.y):g(e,0,1,a.distance,e.x);return h.distance>c?[a]:[a].concat(d(h))}function f(a,b,c,d,f){if(0===b)return e;var g=b>0?Math.floor(c+1)-c:Math.ceil(c-1)-c,h=g*(a/b),i={x:f?d+h:c+g,y:f?c+g:d+h,length:g*g+h*h};return i}function g(a,b,c,d,e){var f=0>j?b:0,g=0>i?c:0;return a.height=h.get(a.x-f,a.y-g),a.distance=d+Math.sqrt(a.length),a.offset=e-Math.floor(e),a}var h=this,i=Math.sin(b),j=Math.cos(b),k={x:a.x,y:a.y,height:0,distance:0};return d(k)},a}();b.GameMap=f}(b=a.GameMap||(a.GameMap={}))}(Engine||(Engine={}));var Engine;!function(a){var b;!function(b){var c,d=a.Util,e=.5,f=.8,g=10,h=3e3,i=function(){function a(a,b,d,i){void 0===d&&(d=f),void 0===i&&(i=g),this.context=a.getContext("2d"),this.width=a.width=window.innerWidth*e,this.height=a.height=window.innerHeight*e,this.resolution=b,this.spacing=this.width/b,this.focalLength=d,this.range=i,c=h*(this.width/this.height),this.viewAngle=0,this.cameraHeight=0}return a.prototype.render=function(a,b){this.viewAngle=a.getHeightInformation().viewAngle,this.cameraHeight=a.getHeightInformation().heightModifier,this.drawSky(a.direction,b.skybox),this.drawColumns(a,b)},a.prototype.drawSky=function(a,b){var e=this,f=b.width*(this.height/b.height)+c,g=a/d.CIRCLE*-f;this.context.save();var i=function(a){e.context.drawImage(b.image,a,e.viewAngle-h/2+e.cameraHeight,f,e.height+h+e.cameraHeight)};i(g),g<f-this.width&&i(g+f),this.context.restore()},a.prototype.drawColumns=function(a,b){this.context.save();for(var c=0;c<this.resolution;c++){var d=c/this.resolution-.5,e=Math.atan2(d,this.focalLength),f=b.cast(a,a.direction+e,this.range);this.drawColumn(c,f,e,b)}this.context.restore()},a.prototype.drawColumn=function(a,b,c,d){for(var e=this.context,f=d.wallTexture,g=Math.floor(a*this.spacing),h=Math.ceil(this.spacing),i=0;i<b.length&&b[i].height<=0;)i++;for(var j=b.length-1;j>=0;j--){var k=b[j];if(j===i){var l=Math.floor(f.width*k.offset),m=this.project(k.height,c,k.distance);e.drawImage(f.image,l,0,1,f.height,g,m.top+this.viewAngle+this.cameraHeight,h,m.height+this.cameraHeight)}}},a.prototype.project=function(a,b,c){var d=c*Math.cos(b),e=this.height*a/d,f=this.height/2*(1+1/d);return{top:f-e,height:e}},a}();b.Camera=i}(b=a.Camera||(a.Camera={}))}(Engine||(Engine={}));var Engine;!function(a){var b;!function(a){var b=1/30,c=1e3,d=function(){function a(a){void 0===a&&(a=b),this.frameCallback=this.frame.bind(this),this.lastTime=0,this.accumulator=0,this.timestep=a,this.updateCallback=function(){},this.renderCallback=function(){}}return a.prototype.start=function(a,b){this.updateCallback=a,this.renderCallback=b,window.requestAnimationFrame(this.frameCallback)},a.prototype.frame=function(a){var b=(a-this.lastTime)/c;for(this.lastTime=a,this.accumulator+=b;this.accumulator>=this.timestep;)this.accumulator-=this.timestep,this.updateCallback(this.timestep);this.renderCallback(),window.requestAnimationFrame(this.frameCallback)},a}();a.GameLoop=d}(b=a.GameLoop||(a.GameLoop={}))}(Engine||(Engine={}));var Engine;!function(a){var b;!function(b){function c(){var a=document.getElementById("display"),b=new h(15.3,-1.2,.3*Math.PI),c=new g(32),i=new e,j=new d(a,240,.6),k=new f;c.randomize(),k.start(function(a){b.update(i.states,c,a)},function(){j.render(b,c)})}var d=a.Camera.Camera,e=a.Controls.Controls,f=a.GameLoop.GameLoop,g=a.GameMap.GameMap,h=a.Player.Player;b.exec=c}(b=a.Main||(a.Main={}))}(Engine||(Engine={})),Engine.Main.exec();
//# sourceMappingURL=raycaster.min.map